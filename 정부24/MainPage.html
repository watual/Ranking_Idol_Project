<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>musicList</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
    <link rel="stylesheet" href="wonha.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
    <div class="full_size"> <!--1번-->
        <div class="logo">
            <a href="MainPage.html">
                <img src="src/logo.png" alt="Music" />
            </a>
        </div>
        <div class="nav_top_profile">
            <div class="nav_top_profile_iden">
                <img class="icon" src="src/icon/user.png">
            </div>
            <div class="nav_top_profile_setting">
                <img class="icon" src="src/icon/set.png">
            </div>
        </div>
        <div class="nav_top" id="div1"> <!--상단 nav bar-->
            <div class="nav_top_item">
                <input class="nav_top_text" value="♬~노래 검색">
                <input type="text" name="searchText" class="nav_top_search" required="required">
                <input type="button" class="nav_top_search_submit" value="▷">
            </div>
        </div>
        <div class="mainDiv">
            <div class="nav_left"> <!--좌측 nav bar-->
                <div class="nav_left_top">
                    <ul>
                        <li onclick="location.href='MainPage.html';">
                            <img class="icon" src="src/icon/home.png" />
                            <a>
                                홈
                            </a>
                        </li>
                        <li>
                            <img class="icon" src="src/icon/search.png" />
                            <a href="">
                                둘러보기
                            </a>
                        </li>
                        <li>
                            <img class="icon" src="src/icon/myPlayList.png" />
                            <a href="">
                                My PlayList
                            </a>
                        </li>
                        <div style="height: 70px;">

                        </div>
                    </ul>
                </div>
                <div class="nav_left_top">
                    <ul id="nav_playlist">
                        <!-- 재생목록 -->
                        <li>
                            playList1
                        </li>
                    </ul>
                </div>
            </div>
            <div class="mainContent1">
                <!-- 추천노래 -->
                <div class="titleText titleText_rec">최신 추천곡</div>
                <div class="recommendSong">
                    <div class="recommendSong_item">
                        <img class="albumThumnail" src="src/album/MashUp.webp"
                            onclick="location.href='https:www.youtube.com/watch?v=SXE-gIU3yJs&list=RDGMEM0s70dY0AfCwh3LqQ-Bv1xg&start_radio=1&rv=QgMFpuos4Rg';">
                        <div>MashUp _ 아이네</div>
                    </div>
                    <div class="recommendSong_item">
                        <img class="albumThumnail" src="src/album/ReWind.jpg"
                            onclick="location.href='https:www.youtube.com/watch?v=fgSXAKsq-Vo';">
                        <div>RE:WIND _ 이세계아이돌</div>
                    </div>
                    <div class="recommendSong_item">
                        <img class="albumThumnail" src="src/album/겨울봄.jpg"
                            onclick="location.href='https:www.youtube.com/watch?v=JY-gJkMuJ94';">
                        <div>겨울봄 _ 이세계아이돌</div>
                    </div>
                    <div class="recommendSong_item">
                        <img class="albumThumnail" src="src/album/LockDown.jpg"
                            onclick="location.href='https:www.youtube.com/watch?v=QgMFpuos4Rg';">
                        <div>LockDown _ 이세계아이돌</div>
                    </div>
                    <div class="recommendSong_item">
                        <img class="albumThumnail" src="src/album/Kidding.jpg"
                            onclick="location.href='https:www.youtube.com/watch?v=rDFUl2mHIW4';">
                        <div>Kidding _ 이세계아이돌</div>
                    </div>
                </div>

                <div class="mainContent2">
                    <!-- 가수순위 -->
                    <div class="idolRank">
                        <div class="titleText">Artist Rank</div>
                    </div>
                    <!-- 노래순위 -->
                    <div class="musicRank">
                        <div class="titleText">Music Rank</div>
                    </div>
                </div>
            </div>
            <div></div>
        </div>
    </div>
    <!-- ------------------------스크립트----------------------------- -->
    <script type="module" defer>
        //firebaseDB 세팅
        // Firebase SDK 라이브러리 가져오기
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, doc, deleteDoc, query, limit, collection, addDoc, orderBy, getDocs, getDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        // Firebase 구성 정보 설정
        const firebaseConfig = {
            apiKey: "AIzaSyDUo3wGBYmzDE0daVh0twAmzZ2r8TzyrGE",
            authDomain: "watual-f9224.firebaseapp.com",
            projectId: "watual-f9224",
            storageBucket: "watual-f9224.appspot.com",
            messagingSenderId: "307021915043",
            appId: "1:307021915043:web:ec35f5002d695d81a1f016",
            measurementId: "G-248XS4LSEE"
        };
        // Firebase 인스턴스 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let docs;
        // Firebase DB, Table 호출
        (async () => {
            docs = await getDocs(collection(db,"rankingidol"));
            document.addEventListener("DOMContentLoaded", function () {
                console.log(docs);
                //index, emptyIndex, 0{createUser, artist, link, music }, 1, 2, ...
                // docs.playlist.forEach((i) => {
                //     let dataPlaylist = i.data();
                //     alert(dataPlaylist);
                // });
            });
        })();

        //문서 로드, 함수 호출
        document.addEventListener("DOMContentLoaded", ready);
        function ready() {
            //창 그라데이션 출력
            document.getElementsByClassName('full_size');
            
            //로그인 조회
            let loginData = sessionStorage.getItem('id');
            // console.log(loginData);
            if (loginData == null) {
                document.getElementById('nav_playlist')
                $('#nav_playlist').append(`
                        <li>
                            playList_new
                        </li>`);
            }
            //아이돌 랭크 데이터
            let getTopArtists = "https://ws.audioscrobbler.com/2.0/?method=chart.gettopartists&api_key=54f23d667cf616502635a2d6dc54b1bb&format=json";
            // console.log(getTopArtists);
            fetch(getTopArtists)
                .then((response) => response.json())
                .then(async (data) => {
                    console.log(data);
                    const dataResponse = data.artists.artist;
                    dataResponse.forEach(item => {
                        const dataRes_name = item.name;
                        //const dataRes_image = item.image[0]['#text'];
                        const playCount = item.playcount;
                        const url = item.url;

                        $('.idolRank').append(`
                        <div class="idolRank_item" onclick="location.href='${url}';">
                            <img class="albumThumnail" src="src/icon/image_def.png">
                            <div class="idolRank_item_text">
                                <div onclick="location.href='${url}';">${dataRes_name}</div>
                                <div>조회수 : ${playCount}</div>
                            </div>
                        </div>
                        `);
                    })
                })
                .catch((error) => {
                    console.error('에러코드 : ', error);
                });

            //노래 랭크 데이터
            let getTopTracks = "https://ws.audioscrobbler.com/2.0/?method=chart.gettoptracks&api_key=54f23d667cf616502635a2d6dc54b1bb&format=json";
            fetch(getTopTracks)
                .then((response) => response.json())
                .then(async (data) => {
                    const dataResponse = data.tracks.track;
                    dataResponse.forEach(item => {
                        //console.log(item);
                        const artist = item.artist.name;
                        const name = item.name;
                        const playCount = item.playcount;
                        const url = item.url;

                        $('.musicRank').append(`
                        <div class="musicRank_item">
                            <img class="music_icon" src="src/icon/image_def.png" onclick="location.href='${url}';">
                            <div class="musicRank_item_text">
                                <div>${artist}</div>
                                <div onclick="location.href='${url}';">${name}</div>
                            </div>
                        </div>
                        `);
                    })
                })
                .catch((error) => {
                    console.error('에러코드 : ', error);
                });

            //재생 목록 호출

            //function Ready()
        }
        //데이터 수신
        //데이터 전송
        function sendData() {
            const sendData = document.getElementsByName("searchText")[0].value;
            sessionStorage.setItem('item1', sendData);
            location.href = 'SearchPage.html';
        }

        $(function () {
            $('.nav_top_search').on('input', function (f) {
                if ($('.nav_top_search').val() != '') {
                    $('.nav_top_search_submit').click(function () {
                        sendData();
                    });
                    $('.nav_top_text').attr("value", "");
                    addEventListener('keydown', function (e) {
                        if ((e.code == 'Enter') || (e.code == 'NumpadEnter') && $('.nav_top_search').val() != '') {
                            sendData();
                        }
                    })
                } else {
                    $('.nav_top_text').attr("value", "♬~노래 검색");
                }
            })
        })
    </script>
</body>

</html>